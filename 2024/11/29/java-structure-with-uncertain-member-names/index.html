<!DOCTYPE html><html lang="zh-cmn-Hans" prefix="og: http://ogp.me/ns#" class="han-init"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /><title>Java｜如何用一个统一结构接收成员名称不固定的数据 &mdash; 朱</title><link rel="stylesheet" href="https://zwany1.github.io/assets/vendor/primer-css/css/primer.css"><link rel="stylesheet" href="https://zwany1.github.io/assets/css/components/collection.css"><link rel="stylesheet" href="https://zwany1.github.io/assets/css/components/repo-card.css"><link rel="stylesheet" href="https://zwany1.github.io/assets/css/sections/repo-list.css"><link rel="stylesheet" href="https://zwany1.github.io/assets/css/components/boxed-group.css"><link rel="stylesheet" href="https://zwany1.github.io/assets/css/globals/common.css"><link rel="stylesheet" href="https://zwany1.github.io/assets/css/globals/responsive.css"><link rel="stylesheet" href="https://zwany1.github.io/assets/css/posts/index.css"><link rel="stylesheet" href="https://zwany1.github.io/assets/css/globals/animations.css"><link rel="stylesheet" href="https://zwany1.github.io/assets/vendor/octicons/octicons/octicons.css"><link rel="stylesheet" href="https://mazhuang.org/rouge-themes/dist/github.css"><link rel="canonical" href="https://zwany1.github.io/2024/11/29/java-structure-with-uncertain-member-names/"><link rel="alternate" type="application/atom+xml" title="朱" href="https://zwany1.github.io/feed.xml"><link rel="shortcut icon" href="https://zwany1.github.io/assets/images/d56012bab88f5aabe76bb1fc7eeeb9c6.jpg"><meta property="og:title" content="Java｜如何用一个统一结构接收成员名称不固定的数据"><meta name="keywords" content="Java, 反序列化, 数据结构"><meta name="og:keywords" content="Java, 反序列化, 数据结构"><meta name="description" content="本文介绍了一种 Java 中如何用一个统一结构接收成员名称不固定的数据的方法。"><meta name="og:description" content="本文介绍了一种 Java 中如何用一个统一结构接收成员名称不固定的数据的方法。"><meta property="og:url" content="https://zwany1.github.io/2024/11/29/java-structure-with-uncertain-member-names/"><meta property="og:site_name" content="朱"><meta property="og:type" content="article"><meta property="og:locale" content="zh_CN" /><meta property="article:published_time" content="2024-11-29"> <script src="https://zwany1.github.io/assets/vendor/jquery/dist/jquery.min.js"></script> <script src="https://zwany1.github.io/assets/js/main.js"></script></head><body class="" data-mz=""><header class="site-header"><div class="container"><h1><a href="https://zwany1.github.io/" title="朱"><span class="octicon octicon-mark-github"></span> 朱</a></h1><button class="collapsed mobile-visible" type="button" onclick="toggleMenu();"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button><nav class="site-header-nav" role="navigation"> <a href="https://zwany1.github.io/" class="site-header-nav-item" target="" title="首页">首页</a> <a href="https://zwany1.github.io/categories/" class="site-header-nav-item" target="" title="分类">分类</a> <a href="https://zwany1.github.io/archives/" class="mobile-hidden site-header-nav-item" target="" title="归档">归档</a> <a href="https://zwany1.github.io/open-source/" class="mobile-hidden site-header-nav-item" target="" title="开源">开源</a> <a href="https://zwany1.github.io/fragments/" class="site-header-nav-item" target="" title="片段">片段</a> <a href="https://zwany1.github.io/wiki/" class="site-header-nav-item" target="" title="维基">维基</a> <a href="https://zwany1.github.io/links/" class="mobile-hidden site-header-nav-item" target="" title="链接">链接</a> <a href="https://zwany1.github.io/about/" class="site-header-nav-item" target="" title="关于">关于</a> <a class="mobile-hidden" href="https://zwany1.github.io/feed.xml"><span class="octicon octicon-rss" style="color:orange;"></span></a></nav></div></header><section class="collection-head small geopattern" data-pattern-id="Java｜如何用一个统一结构接"><div class="container"><div class="columns"><div class="column three-fourths"><div class="collection-title"><h1 class="collection-header">Java｜如何用一个统一结构接收成员名称不固定的数据</h1><div class="collection-info"> <span class="meta-info"> <span class="octicon octicon-calendar"></span> 2024/11/29 </span> <span class="meta-info"> <span class="octicon octicon-file-directory"></span> <a href="https://zwany1.github.io/categories/#Java" title="Java">Java</a> </span> <span class="meta-info"> <span class="octicon octicon-clock"></span> 共 4118 字，约 12 分钟 </span></div></div></div><div class="column one-fourth mobile-hidden"><div class="collection-title"> <img style="height:72px;width:72px" src="https://zwany1.github.io/assets/images/qrcode.jpg" alt="朱猪写作" /></div></div></div></div></section><section class="container content"><div class="columns"><div class="column three-fourths" ><article class="article-content markdown-body"><p>本文介绍了一种 Java 中如何用一个统一结构接收成员名称不固定的数据的方法。</p><h2 id="背景">背景</h2><p>最近在做企业微信的内部应用开发，遇到了一个小问题：企业微信的不同接口，返回的数据的结构不完全一样。</p><p>比如，获取部门列表接口返回的数据结构是这样的：</p><div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"errcode"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"errmsg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ok"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"department"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
            </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"广州研发中心"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"name_en"</span><span class="p">:</span><span class="w"> </span><span class="s2">"RDGZ"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"department_leader"</span><span class="p">:[</span><span class="s2">"zhangsan"</span><span class="p">,</span><span class="s2">"lisi"</span><span class="p">],</span><span class="w">
            </span><span class="nl">"parentid"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
            </span><span class="nl">"order"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div><p>而获取部门成员接口返回的数据结构是这样的：</p><div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"errcode"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"errmsg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ok"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"userlist"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"userid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"zhangsan"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"张三"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"department"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">],</span><span class="w">
            </span><span class="nl">"open_userid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"xxxxxx"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div><p>就是说，不同接口的返回框架是一样的，都是 errcode + errmsg + 数据部分，但数据部分的成员名称不一样，比如上面的 <code class="language-plaintext highlighter-rouge">department</code> 和 <code class="language-plaintext highlighter-rouge">userlist</code>。</p><p>我不知道为什么这样设计，从 Java 开发者的习惯来讲，如果由我来设计，我会尽量保持接口返回的数据结构的一致性，比如数据部分都用 <code class="language-plaintext highlighter-rouge">data</code> 来表示，这样在序列化、反序列化的时候可以用一个统一的泛型结构来进行。</p><p>当然这可能是企微内部的开发语言或习惯的差异，或者其它原因，这里也无法深究，只谈如何应对。</p><h2 id="分析">分析</h2><p>遇到这个问题后，第一反应是用 JSON 结构来接收，然后不同接口的数据部分用不同的 key 来读取。可以实现，但总觉得不够优雅。</p><p>然后想到 GitHub 上应该有不少开源的企微开发的封装库，去看看它们的实现，说不定会有更好的方案，最终果然有收获。</p><p>主要看了两个库：</p><ul><li>https://github.com/binarywang/WxJava</li><li>https://github.com/NotFound403/wecom-sdk</li></ul><p>前者 WxJava 知名度更高，包含的东西也更多，包含微信、企微的各种开发包的封装。它这块的实现是用我们前面提到的方法，用 JSON 结构来接收，然后不同接口的数据用不同的 key 来读取。</p><p>后者 wecom-sdk 是企微的开发包。它这块的实现是用了一个统一的泛型结构来接收数据。</p><p>以下分别截取两个库的两个部门管理相关接口的封装代码：</p><p><strong>WxJava 版：</strong></p><p><em>https://github.com/binarywang/WxJava/blob/develop/weixin-java-cp/src/main/java/me/chanjar/weixin/cp/api/impl/WxCpDepartmentServiceImpl.java</em></p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">WxCpDepart</span><span class="o">&gt;</span> <span class="nf">list</span><span class="o">(</span><span class="nc">Long</span> <span class="n">id</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">WxErrorException</span> <span class="o">{</span>
    <span class="nc">String</span> <span class="n">url</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">mainService</span><span class="o">.</span><span class="na">getWxCpConfigStorage</span><span class="o">().</span><span class="na">getApiUrl</span><span class="o">(</span><span class="no">DEPARTMENT_LIST</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">id</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">url</span> <span class="o">+=</span> <span class="s">"?id="</span> <span class="o">+</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nc">String</span> <span class="n">responseContent</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">mainService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">url</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
    <span class="nc">JsonObject</span> <span class="n">tmpJsonObject</span> <span class="o">=</span> <span class="nc">GsonParser</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">responseContent</span><span class="o">);</span>
    <span class="k">return</span> <span class="nc">WxCpGsonBuilder</span><span class="o">.</span><span class="na">create</span><span class="o">()</span>
      <span class="o">.</span><span class="na">fromJson</span><span class="o">(</span><span class="n">tmpJsonObject</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"department"</span><span class="o">),</span>
        <span class="k">new</span> <span class="nc">TypeToken</span><span class="o">&lt;</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">WxCpDepart</span><span class="o">&gt;&gt;()</span> <span class="o">{</span>
        <span class="o">}.</span><span class="na">getType</span><span class="o">()</span>
      <span class="o">);</span>
  <span class="o">}</span>

<span class="nd">@Override</span>
<span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">WxCpDepart</span><span class="o">&gt;</span> <span class="nf">simpleList</span><span class="o">(</span><span class="nc">Long</span> <span class="n">id</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">WxErrorException</span> <span class="o">{</span>
    <span class="nc">String</span> <span class="n">url</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">mainService</span><span class="o">.</span><span class="na">getWxCpConfigStorage</span><span class="o">().</span><span class="na">getApiUrl</span><span class="o">(</span><span class="no">DEPARTMENT_SIMPLE_LIST</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">id</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">url</span> <span class="o">+=</span> <span class="s">"?id="</span> <span class="o">+</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nc">String</span> <span class="n">responseContent</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">mainService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">url</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
    <span class="nc">JsonObject</span> <span class="n">tmpJsonObject</span> <span class="o">=</span> <span class="nc">GsonParser</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">responseContent</span><span class="o">);</span>
    <span class="k">return</span> <span class="nc">WxCpGsonBuilder</span><span class="o">.</span><span class="na">create</span><span class="o">()</span>
      <span class="o">.</span><span class="na">fromJson</span><span class="o">(</span><span class="n">tmpJsonObject</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"department_id"</span><span class="o">),</span>
        <span class="k">new</span> <span class="nc">TypeToken</span><span class="o">&lt;</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">WxCpDepart</span><span class="o">&gt;&gt;()</span> <span class="o">{</span>
        <span class="o">}.</span><span class="na">getType</span><span class="o">()</span>
      <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p><strong>wecom-sdk 版：</strong></p><p><em>https://github.com/NotFound403/wecom-sdk/blob/release/wecom-sdk/src/main/java/cn/felord/api/DepartmentApi.java</em></p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@GET</span><span class="o">(</span><span class="s">"department/list"</span><span class="o">)</span>
<span class="nc">GenericResponse</span><span class="o">&lt;</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">DeptInfo</span><span class="o">&gt;&gt;</span> <span class="nf">deptList</span><span class="o">(</span><span class="nd">@Query</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span> <span class="kt">long</span> <span class="n">departmentId</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">WeComException</span><span class="o">;</span>

<span class="nd">@GET</span><span class="o">(</span><span class="s">"department/simplelist"</span><span class="o">)</span>
<span class="nc">GenericResponse</span><span class="o">&lt;</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">DeptSimpleInfo</span><span class="o">&gt;&gt;</span> <span class="nf">getSimpleList</span><span class="o">(</span><span class="nd">@Query</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span> <span class="kt">long</span> <span class="n">departmentId</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">WeComException</span><span class="o">;</span>
</code></pre></div></div><p>抛开 wecom-sdk 版引入了 Retrofit2 库的支持导致的代码量锐减，在返回数据的反序列化上，我也更倾向于 wecom-sdk 版的实现。</p><h2 id="实现">实现</h2><p>那接下来我们直接参照 wecom-sdk 里的实现方式，写一个泛型类，就可以用来接收企微的不同接口返回的数据了：</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Data</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WxWorkResponse</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="nd">@JsonProperty</span><span class="o">(</span><span class="s">"errmsg"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">errMsg</span><span class="o">;</span>

    <span class="nd">@JsonProperty</span><span class="o">(</span><span class="s">"errcode"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Integer</span> <span class="n">errCode</span><span class="o">;</span>

    <span class="nd">@JsonAlias</span><span class="o">({</span>
            <span class="s">"department"</span><span class="o">,</span>
            <span class="s">"userlist"</span>
    <span class="o">})</span>
    <span class="kd">private</span> <span class="no">T</span> <span class="n">data</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div><p>这里面起到关键作用的是 Jackson 库里的 <code class="language-plaintext highlighter-rouge">@JsonAlias</code> 注解。它的官方文档是这样介绍的：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Annotation that can be used to define one or more alternative names for a property, accepted during deserialization as alternative to the official name. Alias information is also exposed during POJO introspection, but has no effect during serialization where primary name is always used.
Examples:
  public class Info {
    @JsonAlias({ "n", "Name" })
    public String name;
  }
  
NOTE: Order of alias declaration has no effect. All properties are assigned in the order they come from incoming JSON document. If same property is assigned more than once with different value, later will remain. For example, deserializing
   public class Person {
      @JsonAlias({ "name", "fullName" })
      public String name;
   }
   
from
   { "fullName": "Faster Jackson", "name": "Jackson" }
   
will have value "Jackson".
Also, can be used with enums where incoming JSON properties may not match the defined enum values. For instance, if you have an enum called Size with values SMALL, MEDIUM, and LARGE, you can use this annotation to define alternate values for each enum value. This way, the deserialization process can map the incoming JSON values to the correct enum values.
Sample implementation:
public enum Size {
       @JsonAlias({ "small", "s", "S" })
       SMALL,
  
       @JsonAlias({ "medium", "m", "M" })
       MEDIUM,
  
       @JsonAlias({ "large", "l", "L" })
       LARGE
   }
During deserialization, any of these JSON structures will be valid and correctly mapped to the MEDIUM enum value: {"size": "m"}, {"size": "medium"}, or {"size": "M"}.
</code></pre></div></div><p>回到我们的例子，除了 <code class="language-plaintext highlighter-rouge">department</code> 和 <code class="language-plaintext highlighter-rouge">userlist</code> 之外还用到其它的 key，可以继续在 <code class="language-plaintext highlighter-rouge">@JsonAlias</code> 注解里添加。</p><p>这样，对不同的接口的封装，我们反序列化后统一 <code class="language-plaintext highlighter-rouge">getData()</code> 就可以获取到数据部分了，使用时不用再去操心数据部分的 key 是什么。</p><h2 id="小结">小结</h2><p>有人总问，阅读别人源码的意义是什么，这也许就可以作为一个小例子吧。</p><div style="margin-top:2em;padding:0 1.5em;border:1px solid #d3d3d3;background-color:#deebf7"><h3>文档信息</h3><ul><li>本文作者：<a href="https://zwany1.github.io" target="_blank">朱</a></li><li>本文链接：<a href="https://zwany1.github.io/2024/11/29/java-structure-with-uncertain-member-names/" target="_blank">https://zwany1.github.io/2024/11/29/java-structure-with-uncertain-member-names/</a></li><li>版权声明：自由转载-非商用-非衍生-保持署名（<a href="http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh" target="_blank">创意共享3.0许可证</a>）</li></ul></div></article><div class="share"></div><div class="comment"> <script src="https://utteranc.es/client.js" repo="zwany1/zwany1.github.io" issue-term="title" label="gitment" theme="github-light" crossorigin="anonymous" async> </script></div></div><div class="column one-fourth"><h3>Search</h3><div id="site_search"> <input style="width:96%" type="text" id="search_box" placeholder="Search"></div><ul id="search_results" style="font-size:14px;list-style-type:none;padding-top:10px;padding-left:10px;"></ul><script src="https://zwany1.github.io/assets/js/simple-jekyll-search.min.js"></script> <script type="text/javascript"> SimpleJekyllSearch({ searchInput: document.getElementById('search_box'), resultsContainer: document.getElementById('search_results'), json: 'https://zwany1.github.io/assets/search_data.json?v=1765178309', searchResultTemplate: '<li><a href="{url}" title="{title}">{title}</a></li>', noResultsText: 'No results found', limit: 10, fuzzy: false, exclude: ['Welcome'] }) </script><h3 class="post-directory-title mobile-hidden">Table of Contents</h3><div id="post-directory-module" class="mobile-hidden"><section class="post-directory"><dl></dl></section></div><script src="https://zwany1.github.io/assets/js/jquery.toc.js"></script></div></div></section><footer class="container"><div class="site-footer" role="contentinfo"><div class="copyright left mobile-block"> © 2025 <span title="朱">朱</span> <a href="javascript:window.scrollTo(0,0)" class="right mobile-visible">TOP</a></div><ul class="site-footer-links right mobile-hidden"><li> <a href="javascript:window.scrollTo(0,0)" >TOP</a></li></ul><a href="https://github.com/zwany1/zwany1.github.io" target="_blank" aria-label="view source code"> <span class="mega-octicon octicon-mark-github" title="GitHub"></span> </a><ul class="site-footer-links mobile-hidden"><li> <a href="https://zwany1.github.io/" title="首页" target="">首页</a></li><li> <a href="https://zwany1.github.io/categories/" title="分类" target="">分类</a></li><li> <a href="https://zwany1.github.io/archives/" title="归档" target="">归档</a></li><li> <a href="https://zwany1.github.io/open-source/" title="开源" target="">开源</a></li><li> <a href="https://zwany1.github.io/fragments/" title="片段" target="">片段</a></li><li> <a href="https://zwany1.github.io/wiki/" title="维基" target="">维基</a></li><li> <a href="https://zwany1.github.io/links/" title="链接" target="">链接</a></li><li> <a href="https://zwany1.github.io/about/" title="关于" target="">关于</a></li><li><a href="https://zwany1.github.io/feed.xml"><span class="octicon octicon-rss" style="color:orange;"></span></a></li></ul></div></footer><div class="tools-wrapper"> <a class="gotop" href="#" title="回到顶部"><span class="octicon octicon-arrow-up"></span></a></div><script src="https://zwany1.github.io/assets/js/geopattern.js"></script> <script> jQuery(document).ready(function($) { $('.geopattern').each(function(){ $(this).geopattern($(this).data('pattern-id')); }); /* hljs.initHighlightingOnLoad(); */ }); </script></body></html>
