<!DOCTYPE html><html lang="zh-cmn-Hans" prefix="og: http://ogp.me/ns#" class="han-init"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /><title>Java｜在 IDEA 里自动生成 MyBatis 模板代码 &mdash; 朱</title><link rel="stylesheet" href="https://zwany1.github.io/assets/vendor/primer-css/css/primer.css"><link rel="stylesheet" href="https://zwany1.github.io/assets/css/components/collection.css"><link rel="stylesheet" href="https://zwany1.github.io/assets/css/components/repo-card.css"><link rel="stylesheet" href="https://zwany1.github.io/assets/css/sections/repo-list.css"><link rel="stylesheet" href="https://zwany1.github.io/assets/css/components/boxed-group.css"><link rel="stylesheet" href="https://zwany1.github.io/assets/css/globals/common.css"><link rel="stylesheet" href="https://zwany1.github.io/assets/css/globals/responsive.css"><link rel="stylesheet" href="https://zwany1.github.io/assets/css/posts/index.css"><link rel="stylesheet" href="https://zwany1.github.io/assets/css/globals/animations.css"><link rel="stylesheet" href="https://zwany1.github.io/assets/vendor/octicons/octicons/octicons.css"><link rel="stylesheet" href="https://mazhuang.org/rouge-themes/dist/github.css"><link rel="canonical" href="https://zwany1.github.io/2024/09/24/custom-idea-mybatis-code-generator/"><link rel="alternate" type="application/atom+xml" title="朱" href="https://zwany1.github.io/feed.xml"><link rel="shortcut icon" href="https://zwany1.github.io/assets/images/d56012bab88f5aabe76bb1fc7eeeb9c6.jpg"><meta property="og:title" content="Java｜在 IDEA 里自动生成 MyBatis 模板代码"><meta name="keywords" content="后端, Java, MyBatis, IDEA, 代码生成器"><meta name="og:keywords" content="后端, Java, MyBatis, IDEA, 代码生成器"><meta name="description" content="背景"><meta name="og:description" content="背景"><meta property="og:url" content="https://zwany1.github.io/2024/09/24/custom-idea-mybatis-code-generator/"><meta property="og:site_name" content="朱"><meta property="og:type" content="article"><meta property="og:locale" content="zh_CN" /><meta property="article:published_time" content="2024-09-24"> <script src="https://zwany1.github.io/assets/vendor/jquery/dist/jquery.min.js"></script> <script src="https://zwany1.github.io/assets/js/main.js"></script></head><body class="" data-mz=""><header class="site-header"><div class="container"><h1><a href="https://zwany1.github.io/" title="朱"><span class="octicon octicon-mark-github"></span> 朱</a></h1><button class="collapsed mobile-visible" type="button" onclick="toggleMenu();"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button><nav class="site-header-nav" role="navigation"> <a href="https://zwany1.github.io/" class="site-header-nav-item" target="" title="首页">首页</a> <a href="https://zwany1.github.io/categories/" class="site-header-nav-item" target="" title="分类">分类</a> <a href="https://zwany1.github.io/archives/" class="mobile-hidden site-header-nav-item" target="" title="归档">归档</a> <a href="https://zwany1.github.io/open-source/" class="mobile-hidden site-header-nav-item" target="" title="开源">开源</a> <a href="https://zwany1.github.io/fragments/" class="site-header-nav-item" target="" title="片段">片段</a> <a href="https://zwany1.github.io/wiki/" class="site-header-nav-item" target="" title="维基">维基</a> <a href="https://zwany1.github.io/links/" class="mobile-hidden site-header-nav-item" target="" title="链接">链接</a> <a href="https://zwany1.github.io/about/" class="site-header-nav-item" target="" title="关于">关于</a> <a class="mobile-hidden" href="https://zwany1.github.io/feed.xml"><span class="octicon octicon-rss" style="color:orange;"></span></a></nav></div></header><section class="collection-head small geopattern" data-pattern-id="Java｜在 IDEA 里自动"><div class="container"><div class="columns"><div class="column three-fourths"><div class="collection-title"><h1 class="collection-header">Java｜在 IDEA 里自动生成 MyBatis 模板代码</h1><div class="collection-info"> <span class="meta-info"> <span class="octicon octicon-calendar"></span> 2024/09/24 </span> <span class="meta-info"> <span class="octicon octicon-file-directory"></span> <a href="https://zwany1.github.io/categories/#Java" title="Java">Java</a> </span> <span class="meta-info"> <span class="octicon octicon-clock"></span> 共 7138 字，约 21 分钟 </span></div></div></div><div class="column one-fourth mobile-hidden"><div class="collection-title"> <img style="height:72px;width:72px" src="https://zwany1.github.io/assets/images/qrcode.jpg" alt="朱猪写作" /></div></div></div></div></section><section class="container content"><div class="columns"><div class="column three-fourths" ><article class="article-content markdown-body"><h2 id="背景">背景</h2><p>基于 MyBatis 开发的项目，新增数据库表以后，总是需要编写对应的 Entity、Mapper 和 Service 等等 Class 的代码，这些都是重复的工作，我们可以想一些办法来自动生成这些代码。</p><h2 id="方案">方案</h2><p>一种可选的方案是使用 MyBatis Generator，官方支持，常见需求一般也都能满足。但是它的配置文件比较繁琐，如果有一些项目相关的个性化需求，不一定很好处理。</p><p>这里介绍另外一种我觉得更为简便灵活的方法。</p><p>近几年版本的 IDEA 里已经自带了 Database Tools and SQL 插件，可以连接数据库进行常用的操作，并且，它还自带了数据库表对应 POJO 类的代码生成器：在 Database 面板里配置好数据源以后，右键表名，依次选择 Scripted Extensions、Generate POJOs.groovy，选择生成路径后，即可生成对应的 Entity 类。</p><p><img src="https://zwany1.github.io/images/posts/java/generate-pojos.png" alt="" /></p><p>既然能够生成 Entity，那么我们可以基于它进行修改，让它一次性生成我们需要的 Entity、Mapper 和 Service。</p><h2 id="需求">需求</h2><p>基于项目情况，我们对生成的代码有如下要求：</p><ol><li>Entity 需要继承指定基类，数据库表的公共字段放在基类里；</li><li>Mapper、Service 和 ServiceImpl 分别需要实现指定的类继承关系；</li><li>Entity、Mapper 和 Service 需要自动放在对应的子包下。</li></ol><p>以 t_promotion_channel 表为例，指定该表和对应的代码目录之后，生成的目录结构如下：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.
├── entity
│   └── PromotionChannel.java
├── mapper
│   └── PromotionChannelMapper.java
└── service
    ├── PromotionChannelService.java
    └── impl
        └── PromotionChannelServiceImpl.java
</code></pre></div></div><p>需要生成的代码如下：</p><p><em>entity/PromotionChannel.java</em></p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.test.data.promotion.entity</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.test.common.base.BaseEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.Data</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.EqualsAndHashCode</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Table</span><span class="o">;</span>

<span class="cm">/**
 * @author mazhuang
 */</span>
<span class="nd">@EqualsAndHashCode</span><span class="o">(</span><span class="n">callSuper</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="nd">@Data</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"t_promotion_channel"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PromotionChannel</span> <span class="kd">extends</span> <span class="nc">BaseEntity</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">5495175453870776988L</span><span class="o">;</span>
    <span class="cm">/**
     * 用户ID
     */</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">fkUserId</span><span class="o">;</span>

    <span class="cm">/**
     * 渠道名称
     */</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">channelName</span><span class="o">;</span>

<span class="o">}</span>
</code></pre></div></div><p><em>mapper/PromotionChannelMapper.java</em></p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.test.data.promotion.mapper</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.test.common.base.BaseMapper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.test.data.promotion.entity.PromotionChannel</span><span class="o">;</span>

<span class="cm">/**
 * @author mazhuang
 */</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">PromotionChannelMapper</span> <span class="kd">extends</span> <span class="nc">BaseMapper</span><span class="o">&lt;</span><span class="nc">PromotionChannel</span><span class="o">&gt;</span> <span class="o">{</span>

<span class="o">}</span>
</code></pre></div></div><p><em>service/PromotionChannelService.java</em></p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.test.data.promotion.service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.test.common.base.BaseService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.test.data.promotion.entity.PromotionChannel</span><span class="o">;</span>

<span class="cm">/**
 * @author mazhuang
 */</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">PromotionChannelService</span> <span class="kd">extends</span> <span class="nc">BaseService</span><span class="o">&lt;</span><span class="nc">PromotionChannel</span><span class="o">&gt;</span> <span class="o">{</span>

<span class="o">}</span>
</code></pre></div></div><p><em>service/impl/PromotionChannelServiceImpl.java</em></p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.test.data.promotion.service.impl</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">lombok.extern.slf4j.Slf4j</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.test.common.base.BaseServiceImpl</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.test.data.promotion.entity.PromotionChannel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.test.data.promotion.mapper.PromotionChannelMapper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.test.data.promotion.service.PromotionChannelService</span><span class="o">;</span>

<span class="cm">/**
 * @author mazhuang
 */</span>
<span class="nd">@Slf4j</span>
<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PromotionChannelServiceImpl</span> <span class="kd">extends</span> <span class="nc">BaseServiceImpl</span><span class="o">&lt;</span><span class="nc">PromotionChannelMapper</span><span class="o">,</span> <span class="nc">PromotionChannel</span><span class="o">&gt;</span> <span class="kd">implements</span> <span class="nc">PromotionChannelService</span> <span class="o">{</span>

<span class="o">}</span>
</code></pre></div></div><h2 id="实现">实现</h2><p>右键一个数据库表，依次选择 Scripted Extensions、Go to Scripts Directory，进入生成的脚本目录，找到 Generate POJOs.groovy，复制一份，重命名为 Generate MyBatis Code.groovy，然后修改内容如下：</p><div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">com.intellij.database.model.DasTable</span>
<span class="kn">import</span> <span class="nn">com.intellij.database.util.Case</span>
<span class="kn">import</span> <span class="nn">com.intellij.database.util.DasUtil</span>

<span class="cm">/*
 * Available context bindings:
 *   SELECTION   Iterable&lt;DasObject&gt;
 *   PROJECT     project
 *   FILES       files helper
 */</span>

<span class="n">typeMapping</span> <span class="o">=</span> <span class="o">[</span>
        <span class="o">(~</span><span class="s">/(?i)int/</span><span class="o">)</span>                      <span class="o">:</span> <span class="s2">"Long"</span><span class="o">,</span>
        <span class="o">(~</span><span class="s">/(?i)float|double|decimal|real/</span><span class="o">):</span> <span class="s2">"BigDecimal"</span><span class="o">,</span>
        <span class="o">(~</span><span class="s">/(?i)datetime|timestamp/</span><span class="o">)</span>       <span class="o">:</span> <span class="s2">"java.util.Date"</span><span class="o">,</span>
        <span class="o">(~</span><span class="s">/(?i)date/</span><span class="o">)</span>                     <span class="o">:</span> <span class="s2">"java.sql.Date"</span><span class="o">,</span>
        <span class="o">(~</span><span class="s">/(?i)time/</span><span class="o">)</span>                     <span class="o">:</span> <span class="s2">"java.sql.Time"</span><span class="o">,</span>
        <span class="o">(~</span><span class="s">/(?i)/</span><span class="o">)</span>                         <span class="o">:</span> <span class="s2">"String"</span>
<span class="o">]</span>

<span class="n">FILES</span><span class="o">.</span><span class="na">chooseDirectoryAndSave</span><span class="o">(</span><span class="s2">"Choose directory"</span><span class="o">,</span> <span class="s2">"Choose where to store generated files"</span><span class="o">)</span> <span class="o">{</span> <span class="n">dir</span> <span class="o">-&gt;</span>
    <span class="n">SELECTION</span><span class="o">.</span><span class="na">filter</span> <span class="o">{</span> <span class="n">it</span> <span class="k">instanceof</span> <span class="n">DasTable</span> <span class="o">}.</span><span class="na">each</span> <span class="o">{</span> <span class="n">generate</span><span class="o">(</span><span class="n">it</span><span class="o">,</span> <span class="n">dir</span><span class="o">)</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kt">def</span> <span class="nf">generate</span><span class="o">(</span><span class="n">table</span><span class="o">,</span> <span class="n">dir</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">className</span> <span class="o">=</span> <span class="n">javaName</span><span class="o">(</span><span class="n">table</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">replaceFirst</span><span class="o">(</span><span class="s1">'t_'</span><span class="o">,</span> <span class="s1">''</span><span class="o">),</span> <span class="kc">true</span><span class="o">)</span>
    <span class="kt">def</span> <span class="n">fields</span> <span class="o">=</span> <span class="n">calcFields</span><span class="o">(</span><span class="n">table</span><span class="o">)</span>

    <span class="n">dirPath</span> <span class="o">=</span> <span class="n">dir</span><span class="o">.</span><span class="na">getAbsolutePath</span><span class="o">()</span>
    <span class="n">packageName</span> <span class="o">=</span> <span class="n">calcPackageName</span><span class="o">(</span><span class="n">dirPath</span><span class="o">)</span>

    <span class="c1">// Generate POJO</span>
    <span class="k">new</span> <span class="nf">File</span><span class="o">(</span><span class="n">dirPath</span> <span class="o">+</span> <span class="n">File</span><span class="o">.</span><span class="na">separator</span> <span class="o">+</span> <span class="s2">"entity"</span><span class="o">,</span> <span class="n">className</span> <span class="o">+</span> <span class="s2">".java"</span><span class="o">).</span><span class="na">withPrintWriter</span><span class="o">(</span><span class="s2">"utf-8"</span><span class="o">)</span> <span class="o">{</span> <span class="n">out</span> <span class="o">-&gt;</span> <span class="n">generateEntity</span><span class="o">(</span><span class="n">out</span><span class="o">,</span> <span class="n">table</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span> <span class="n">className</span><span class="o">,</span> <span class="n">fields</span><span class="o">,</span> <span class="n">packageName</span><span class="o">)</span> <span class="o">}</span>

    <span class="c1">// Generate Mapper</span>
    <span class="k">new</span> <span class="nf">File</span><span class="o">(</span><span class="n">dirPath</span> <span class="o">+</span> <span class="n">File</span><span class="o">.</span><span class="na">separator</span> <span class="o">+</span> <span class="s2">"mapper"</span><span class="o">,</span> <span class="n">className</span> <span class="o">+</span> <span class="s2">"Mapper.java"</span><span class="o">).</span><span class="na">withPrintWriter</span><span class="o">(</span><span class="s2">"utf-8"</span><span class="o">)</span> <span class="o">{</span> <span class="n">out</span> <span class="o">-&gt;</span> <span class="n">generateMapper</span><span class="o">(</span><span class="n">out</span><span class="o">,</span> <span class="n">className</span><span class="o">,</span> <span class="n">packageName</span><span class="o">)</span> <span class="o">}</span>

    <span class="c1">// Generate Service</span>
    <span class="k">new</span> <span class="nf">File</span><span class="o">(</span><span class="n">dirPath</span> <span class="o">+</span> <span class="n">File</span><span class="o">.</span><span class="na">separator</span> <span class="o">+</span> <span class="s2">"service"</span><span class="o">,</span> <span class="n">className</span> <span class="o">+</span> <span class="s2">"Service.java"</span><span class="o">).</span><span class="na">withPrintWriter</span><span class="o">(</span><span class="s2">"utf-8"</span><span class="o">)</span> <span class="o">{</span> <span class="n">out</span> <span class="o">-&gt;</span> <span class="n">generateService</span><span class="o">(</span><span class="n">out</span><span class="o">,</span> <span class="n">className</span><span class="o">,</span> <span class="n">packageName</span><span class="o">)</span> <span class="o">}</span>

    <span class="c1">// Generate ServiceImpl</span>
    <span class="k">new</span> <span class="nf">File</span><span class="o">(</span><span class="n">dirPath</span> <span class="o">+</span> <span class="n">File</span><span class="o">.</span><span class="na">separator</span> <span class="o">+</span> <span class="s2">"service"</span> <span class="o">+</span> <span class="n">File</span><span class="o">.</span><span class="na">separator</span> <span class="o">+</span> <span class="s2">"impl"</span><span class="o">,</span> <span class="n">className</span> <span class="o">+</span> <span class="s2">"ServiceImpl.java"</span><span class="o">).</span><span class="na">withPrintWriter</span><span class="o">(</span><span class="s2">"utf-8"</span><span class="o">)</span> <span class="o">{</span> <span class="n">out</span> <span class="o">-&gt;</span> <span class="n">generateServiceImpl</span><span class="o">(</span><span class="n">out</span><span class="o">,</span> <span class="n">className</span><span class="o">,</span> <span class="n">packageName</span><span class="o">)</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">static</span> <span class="kt">def</span> <span class="nf">generateEntity</span><span class="o">(</span><span class="n">out</span><span class="o">,</span> <span class="n">tableName</span><span class="o">,</span> <span class="n">className</span><span class="o">,</span> <span class="n">fields</span><span class="o">,</span> <span class="n">packageName</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">out</span><span class="o">.</span><span class="na">println</span> <span class="s2">"package $packageName"</span> <span class="o">+</span> <span class="s2">".entity;"</span>
    <span class="n">out</span><span class="o">.</span><span class="na">println</span> <span class="s2">""</span>
    <span class="n">out</span><span class="o">.</span><span class="na">println</span> <span class="s2">"import com.test.common.base.BaseEntity;"</span>
    <span class="n">out</span><span class="o">.</span><span class="na">println</span> <span class="s2">"import lombok.Data;"</span>
    <span class="n">out</span><span class="o">.</span><span class="na">println</span> <span class="s2">"import lombok.EqualsAndHashCode;"</span>
    <span class="n">out</span><span class="o">.</span><span class="na">println</span> <span class="s2">"import javax.persistence.Table;"</span>
    <span class="n">out</span><span class="o">.</span><span class="na">println</span> <span class="s2">""</span>
    <span class="n">out</span><span class="o">.</span><span class="na">println</span> <span class="s2">"/**\n * @author mazhuang\n */"</span>
    <span class="n">out</span><span class="o">.</span><span class="na">println</span> <span class="s2">"@EqualsAndHashCode(callSuper = true)"</span>
    <span class="n">out</span><span class="o">.</span><span class="na">println</span> <span class="s2">"@Data"</span>
    <span class="n">out</span><span class="o">.</span><span class="na">println</span> <span class="s2">"@Table(name = \"$tableName\")"</span>
    <span class="n">out</span><span class="o">.</span><span class="na">println</span> <span class="s2">"public class $className extends BaseEntity {"</span>
    <span class="n">out</span><span class="o">.</span><span class="na">println</span> <span class="s2">""</span>

    <span class="kt">def</span> <span class="n">baseEntityFields</span> <span class="o">=</span> <span class="o">[</span><span class="s1">'pkid'</span><span class="o">,</span> <span class="s1">'addedBy'</span><span class="o">,</span> <span class="s1">'addedTime'</span><span class="o">,</span> <span class="s1">'lastModifiedBy'</span><span class="o">,</span> <span class="s1">'lastModifiedTime'</span><span class="o">,</span> <span class="s1">'valid'</span><span class="o">]</span>
    <span class="n">fields</span><span class="o">.</span><span class="na">each</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">baseEntityFields</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">it</span><span class="o">.</span><span class="na">name</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">return</span>
        <span class="o">}</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">it</span><span class="o">.</span><span class="na">annos</span> <span class="o">!=</span> <span class="s2">""</span><span class="o">)</span> <span class="n">out</span><span class="o">.</span><span class="na">println</span> <span class="s2">"  ${it.annos}"</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">it</span><span class="o">.</span><span class="na">comment</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="n">out</span><span class="o">.</span><span class="na">println</span> <span class="s2">"    /**\n     * ${it.comment}\n     */"</span>
        <span class="n">out</span><span class="o">.</span><span class="na">println</span> <span class="s2">"    private ${it.type} ${it.name};\n"</span>
    <span class="o">}</span>

    <span class="n">out</span><span class="o">.</span><span class="na">println</span> <span class="s2">"}"</span>
<span class="o">}</span>

<span class="kd">static</span> <span class="kt">def</span> <span class="nf">generateMapper</span><span class="o">(</span><span class="n">out</span><span class="o">,</span> <span class="n">className</span><span class="o">,</span> <span class="n">packageName</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">out</span><span class="o">.</span><span class="na">println</span> <span class="s2">"package $packageName"</span> <span class="o">+</span> <span class="s2">".mapper;"</span>
    <span class="n">out</span><span class="o">.</span><span class="na">println</span> <span class="s2">""</span>

    <span class="n">out</span><span class="o">.</span><span class="na">println</span> <span class="s2">"import com.test.common.base.BaseMapper;"</span>
    <span class="n">out</span><span class="o">.</span><span class="na">println</span> <span class="s2">"import $packageName"</span> <span class="o">+</span> <span class="s2">".entity.$className;"</span>
    <span class="n">out</span><span class="o">.</span><span class="na">println</span> <span class="s2">""</span>

    <span class="n">out</span><span class="o">.</span><span class="na">println</span> <span class="s2">"/**\n * @author mazhuang\n */"</span>
    <span class="n">out</span><span class="o">.</span><span class="na">println</span> <span class="s2">"public interface $className"</span> <span class="o">+</span> <span class="s2">"Mapper extends BaseMapper&lt;$className&gt; {"</span>
    <span class="n">out</span><span class="o">.</span><span class="na">println</span> <span class="s2">""</span>
    <span class="n">out</span><span class="o">.</span><span class="na">println</span> <span class="s2">"}"</span>
<span class="o">}</span>

<span class="kd">static</span> <span class="kt">def</span> <span class="nf">generateService</span><span class="o">(</span><span class="n">out</span><span class="o">,</span> <span class="n">className</span><span class="o">,</span> <span class="n">packageName</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">out</span><span class="o">.</span><span class="na">println</span> <span class="s2">"package $packageName"</span> <span class="o">+</span> <span class="s2">".service;"</span>
    <span class="n">out</span><span class="o">.</span><span class="na">println</span> <span class="s2">""</span>

    <span class="n">out</span><span class="o">.</span><span class="na">println</span> <span class="s2">"import com.test.common.base.BaseService;"</span>
    <span class="n">out</span><span class="o">.</span><span class="na">println</span> <span class="s2">"import $packageName"</span> <span class="o">+</span> <span class="s2">".entity.$className;"</span>
    <span class="n">out</span><span class="o">.</span><span class="na">println</span> <span class="s2">""</span>

    <span class="n">out</span><span class="o">.</span><span class="na">println</span> <span class="s2">"/**\n * @author mazhuang\n */"</span>
    <span class="n">out</span><span class="o">.</span><span class="na">println</span> <span class="s2">"public interface $className"</span> <span class="o">+</span> <span class="s2">"Service extends BaseService&lt;$className&gt; {"</span>
    <span class="n">out</span><span class="o">.</span><span class="na">println</span> <span class="s2">""</span>
    <span class="n">out</span><span class="o">.</span><span class="na">println</span> <span class="s2">"}"</span>
<span class="o">}</span>

<span class="kd">static</span> <span class="kt">def</span> <span class="nf">generateServiceImpl</span><span class="o">(</span><span class="n">out</span><span class="o">,</span> <span class="n">className</span><span class="o">,</span> <span class="n">packageName</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">out</span><span class="o">.</span><span class="na">println</span> <span class="s2">"package $packageName"</span> <span class="o">+</span> <span class="s2">".service.impl;"</span>
    <span class="n">out</span><span class="o">.</span><span class="na">println</span> <span class="s2">""</span>

    <span class="n">out</span><span class="o">.</span><span class="na">println</span> <span class="s2">"import lombok.extern.slf4j.Slf4j;"</span>
    <span class="n">out</span><span class="o">.</span><span class="na">println</span> <span class="s2">"import org.springframework.stereotype.Service;"</span>
    <span class="n">out</span><span class="o">.</span><span class="na">println</span> <span class="s2">"import com.test.common.base.BaseServiceImpl;"</span>
    <span class="n">out</span><span class="o">.</span><span class="na">println</span> <span class="s2">"import $packageName"</span> <span class="o">+</span> <span class="s2">".entity.$className;"</span>
    <span class="n">out</span><span class="o">.</span><span class="na">println</span> <span class="s2">"import $packageName"</span> <span class="o">+</span> <span class="s2">".mapper.$className"</span> <span class="o">+</span> <span class="s2">"Mapper;"</span>
    <span class="n">out</span><span class="o">.</span><span class="na">println</span> <span class="s2">"import $packageName"</span> <span class="o">+</span> <span class="s2">".service.$className"</span> <span class="o">+</span> <span class="s2">"Service;"</span>
    <span class="n">out</span><span class="o">.</span><span class="na">println</span> <span class="s2">""</span>

    <span class="n">out</span><span class="o">.</span><span class="na">println</span> <span class="s2">"/**\n * @author mazhuang\n */"</span>
    <span class="n">out</span><span class="o">.</span><span class="na">println</span> <span class="s2">"@Slf4j"</span>
    <span class="n">out</span><span class="o">.</span><span class="na">println</span> <span class="s2">"@Service"</span>
    <span class="n">out</span><span class="o">.</span><span class="na">println</span> <span class="s2">"public class $className"</span> <span class="o">+</span> <span class="s2">"ServiceImpl extends BaseServiceImpl&lt;$className"</span> <span class="o">+</span> <span class="s2">"Mapper, $className&gt; implements $className"</span> <span class="o">+</span> <span class="s2">"Service {"</span>
    <span class="n">out</span><span class="o">.</span><span class="na">println</span> <span class="s2">""</span>
    <span class="n">out</span><span class="o">.</span><span class="na">println</span> <span class="s2">"}"</span>
<span class="o">}</span>

<span class="kt">def</span> <span class="nf">calcFields</span><span class="o">(</span><span class="n">table</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">DasUtil</span><span class="o">.</span><span class="na">getColumns</span><span class="o">(</span><span class="n">table</span><span class="o">).</span><span class="na">reduce</span><span class="o">([])</span> <span class="o">{</span>
        <span class="n">fields</span><span class="o">,</span> <span class="n">col</span> <span class="o">-&gt;</span>
            <span class="kt">def</span> <span class="n">spec</span> <span class="o">=</span> <span class="n">Case</span><span class="o">.</span><span class="na">LOWER</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="n">col</span><span class="o">.</span><span class="na">getDataType</span><span class="o">().</span><span class="na">getSpecification</span><span class="o">())</span>
            <span class="kt">def</span> <span class="n">typeStr</span> <span class="o">=</span> <span class="n">typeMapping</span><span class="o">.</span><span class="na">find</span> <span class="o">{</span> <span class="n">p</span><span class="o">,</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="n">p</span><span class="o">.</span><span class="na">matcher</span><span class="o">(</span><span class="n">spec</span><span class="o">).</span><span class="na">find</span><span class="o">()</span> <span class="o">}.</span><span class="na">value</span>
            <span class="n">fields</span> <span class="o">+=</span> <span class="o">[[</span>
                               <span class="n">name</span>   <span class="o">:</span> <span class="n">javaName</span><span class="o">(</span><span class="n">col</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span> <span class="kc">false</span><span class="o">),</span>
                               <span class="n">type</span>   <span class="o">:</span> <span class="n">typeStr</span><span class="o">,</span>
                               <span class="nl">comment:</span> <span class="n">col</span><span class="o">.</span><span class="na">getComment</span><span class="o">(),</span> <span class="c1">// 注释</span>
                               <span class="nl">default:</span> <span class="n">col</span><span class="o">.</span><span class="na">getDefault</span><span class="o">(),</span> <span class="c1">// 默认值</span>
                               <span class="n">annos</span>  <span class="o">:</span> <span class="s2">""</span><span class="o">]]</span>

    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">static</span> <span class="kt">def</span> <span class="nf">calcPackageName</span><span class="o">(</span><span class="n">dirPath</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">startPos</span> <span class="o">=</span> <span class="n">dirPath</span><span class="o">.</span><span class="na">indexOf</span><span class="o">(</span><span class="s1">'com'</span><span class="o">)</span>
    <span class="k">return</span> <span class="n">dirPath</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="n">startPos</span><span class="o">).</span><span class="na">replaceAll</span><span class="o">(</span><span class="n">File</span><span class="o">.</span><span class="na">separator</span><span class="o">,</span> <span class="s2">"."</span><span class="o">)</span>
<span class="o">}</span>

<span class="kt">def</span> <span class="nf">javaName</span><span class="o">(</span><span class="n">str</span><span class="o">,</span> <span class="n">capitalize</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">s</span> <span class="o">=</span> <span class="n">com</span><span class="o">.</span><span class="na">intellij</span><span class="o">.</span><span class="na">psi</span><span class="o">.</span><span class="na">codeStyle</span><span class="o">.</span><span class="na">NameUtil</span><span class="o">.</span><span class="na">splitNameIntoWords</span><span class="o">(</span><span class="n">str</span><span class="o">)</span>
            <span class="o">.</span><span class="na">collect</span> <span class="o">{</span> <span class="n">Case</span><span class="o">.</span><span class="na">LOWER</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="n">it</span><span class="o">).</span><span class="na">capitalize</span><span class="o">()</span> <span class="o">}</span>
            <span class="o">.</span><span class="na">join</span><span class="o">(</span><span class="s2">""</span><span class="o">)</span>
            <span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s">/[^\p{javaJavaIdentifierPart}[_]]/</span><span class="o">,</span> <span class="s2">"_"</span><span class="o">)</span>
    <span class="n">capitalize</span> <span class="o">||</span> <span class="n">s</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">?</span> <span class="n">s</span> <span class="o">:</span> <span class="n">Case</span><span class="o">.</span><span class="na">LOWER</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="n">s</span><span class="o">[</span><span class="mi">0</span><span class="o">])</span> <span class="o">+</span> <span class="n">s</span><span class="o">[</span><span class="mi">1</span><span class="o">..-</span><span class="mi">1</span><span class="o">]</span>
<span class="o">}</span>
</code></pre></div></div><p>大功告成，现在右键一个数据库表，依次选择 Scripted Extensions、Generate MyBatis Code.groovy，在弹出的目录选择框里选择想要放置代码的目录，即可生成期望的模板代码了。</p><p>后续如果有一些个性化的代码生成需求，可以根据实际情况修改、新增脚本来完成。</p><h2 id="其它">其它</h2><p>本文代码生成器脚本已上传至 GitHub，仓库地址：<a href="https://github.com/mzlogin/code-generator">https://github.com/mzlogin/code-generator</a>，以后如果有更新，或者新的代码生成脚本，也会放在这个仓库里。</p><div style="margin-top:2em;padding:0 1.5em;border:1px solid #d3d3d3;background-color:#deebf7"><h3>文档信息</h3><ul><li>本文作者：<a href="https://zwany1.github.io" target="_blank">朱</a></li><li>本文链接：<a href="https://zwany1.github.io/2024/09/24/custom-idea-mybatis-code-generator/" target="_blank">https://zwany1.github.io/2024/09/24/custom-idea-mybatis-code-generator/</a></li><li>版权声明：自由转载-非商用-非衍生-保持署名（<a href="http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh" target="_blank">创意共享3.0许可证</a>）</li></ul></div></article><div class="share"></div><div class="comment"></div></div><div class="column one-fourth"><h3>Search</h3><div id="site_search"> <input style="width:96%" type="text" id="search_box" placeholder="Search"></div><ul id="search_results" style="font-size:14px;list-style-type:none;padding-top:10px;padding-left:10px;"></ul><script src="https://zwany1.github.io/assets/js/simple-jekyll-search.min.js"></script> <script type="text/javascript"> SimpleJekyllSearch({ searchInput: document.getElementById('search_box'), resultsContainer: document.getElementById('search_results'), json: 'https://zwany1.github.io/assets/search_data.json?v=1764928258', searchResultTemplate: '<li><a href="{url}" title="{title}">{title}</a></li>', noResultsText: 'No results found', limit: 10, fuzzy: false, exclude: ['Welcome'] }) </script><h3 class="post-directory-title mobile-hidden">Table of Contents</h3><div id="post-directory-module" class="mobile-hidden"><section class="post-directory"><dl></dl></section></div><script src="https://zwany1.github.io/assets/js/jquery.toc.js"></script></div></div></section><footer class="container"><div class="site-footer" role="contentinfo"><div class="copyright left mobile-block"> © 2025 <span title="朱">朱</span> <a href="javascript:window.scrollTo(0,0)" class="right mobile-visible">TOP</a></div><ul class="site-footer-links right mobile-hidden"><li> <a href="javascript:window.scrollTo(0,0)" >TOP</a></li></ul><a href="https://github.com/zwany1/zwany1.github.io" target="_blank" aria-label="view source code"> <span class="mega-octicon octicon-mark-github" title="GitHub"></span> </a><ul class="site-footer-links mobile-hidden"><li> <a href="https://zwany1.github.io/" title="首页" target="">首页</a></li><li> <a href="https://zwany1.github.io/categories/" title="分类" target="">分类</a></li><li> <a href="https://zwany1.github.io/archives/" title="归档" target="">归档</a></li><li> <a href="https://zwany1.github.io/open-source/" title="开源" target="">开源</a></li><li> <a href="https://zwany1.github.io/fragments/" title="片段" target="">片段</a></li><li> <a href="https://zwany1.github.io/wiki/" title="维基" target="">维基</a></li><li> <a href="https://zwany1.github.io/links/" title="链接" target="">链接</a></li><li> <a href="https://zwany1.github.io/about/" title="关于" target="">关于</a></li><li><a href="https://zwany1.github.io/feed.xml"><span class="octicon octicon-rss" style="color:orange;"></span></a></li></ul></div></footer><div class="tools-wrapper"> <a class="gotop" href="#" title="回到顶部"><span class="octicon octicon-arrow-up"></span></a></div><script src="https://zwany1.github.io/assets/js/geopattern.js"></script> <script> jQuery(document).ready(function($) { $('.geopattern').each(function(){ $(this).geopattern($(this).data('pattern-id')); }); /* hljs.initHighlightingOnLoad(); */ }); </script></body></html>
